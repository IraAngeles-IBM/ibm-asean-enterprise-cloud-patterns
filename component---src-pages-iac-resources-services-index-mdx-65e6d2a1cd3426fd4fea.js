(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{CyJs:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return r})),a.d(t,"default",(function(){return m}));a("91GP"),a("rGqo"),a("yt8O"),a("Btvt"),a("RW0V"),a("q1tI");var n=a("7ljp"),o=a("013z");a("qKvR");function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var r={},s=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(n.b)("div",t)}},c=s("PageDescription"),b=s("AnchorLinks"),l=s("AnchorLink"),d={_frontmatter:r},p=o.a;function m(e){var t=e.components,a=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,["components"]);return Object(n.b)(p,i({},d,a,{components:t,mdxType:"MDXLayout"}),Object(n.b)(c,{mdxType:"PageDescription"},Object(n.b)("p",null,"Use IaC to work with managed Cloud Databases and Service Instances")),Object(n.b)("p",null,"Most of the applications requires a database or service. This page explains how to use the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_database")," and ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_resource_instance")," resources to create different type of databases or services. We will use the API movies demo application to demonstrate the use of a provisioned MongoDB database. The following diagram shows the architecture we will build in this page."),Object(n.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"762px"}},"\n      ",Object(n.b)("span",i({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"117.01388888888889%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAAEGElEQVQ4y41Vy24jRRT1Z/ERsEAgsUBivoEVC4TEjiUbCAh2QHiMeGjEjEKUkMFJJiQhZsYZJvHbbaffXV397rZjTw6nKnbGEbPA8tGtvn196ta955ZrW9vb2NrawtHREfb393F8fKyf9/b20G63sbu7i23GHBwc6PXh4SGazSYajQY2Nzdh2zbU5+rqStuaaZro9/sanU4HhmEgiiTyPEdZFkSJNE2RZdktLP1VVWE+n2M2m2nUPM+DEEJDSgkRBDpQES5/vFznC6z6VWySJDeofffTfYRRAhFGqCZTzJ9f4ZI7TS9nN/YWZitYxFzO5je2tnE6Rr0nUFRTTC7nmMyuMb2xz8Gvhlrffnd7XSlCmZXwZYxMpZ8x/TThMa6R8TmUIes6xGg8YklC7Vu+X41NedyKGddmU2C3vYP6s20UWY4kixCnEaJU2ZhgXWVA4gAykfTHJCKyWMeqtfILKUjIDLNiAjOwMPJcjPwUA8KL2YS8YHAOO0wxDDJchBlkWmi/iDMYi1g3yrlpxj4sCJNctT/GveYFnoxtuL4P0w0RM9uuI/Hj4yEc4ePCCWCJWMvl1+YYfw1NuFSE6UmSJi8I07xiyiG6psTa1zYe1i2IKCUJtVdkeLAn8MVXY4xHQvtUNoab4FPG7jy8IFEKmxutZFgxG4lWP8Brb59h7csujMDE0BKURYmP1/p4/Z0zPO7Z6NiOLsOgZeHVt07xyTcWjMTF2KOG43CRYVExoxB2INHphTjt9PH9H+v4p/sUJY/S75joDEJsnGzh/qN7SGPW+ILkXcFNBlh/dBeng3Pd8XI6e0HoCtbC9mAODLR6PZijERIRwbE8eN0+s2pxNNuIfAE/jOE6jO0P0O7xRJxnGUtU05UMXQapAjskdWgDXyIWISybzbBcOGyKawvEnCjfC2E64XUsVeDK1aYoQmrMjivY7X3I9Tfgnu/Ci1hbitUSHMsH70H89j7MkBKJEw5CwRjGfvsmnFYddjKlTv0XhAEfogJwz04w/uwOeid1eOmUHU01ofHDBxje/RCWIqTPSyboNuoYfX4HZnMPDp+V8BeyKRExk53z39E0/mZmlIdvw/JUXRJINsanLGxqU7Ihyud6AbwgZKkKEvEEUbyqw5JBMRrDP9E2jtmEDsXdgx85nF2OH9/l1GOSxLoE6oq7vitLFEVOqOnJbtcw4BxG6iIY1hFtvAt/sAOfYlfBavA7T120Th29Vj4FRapQ5C8hVIPtZdTik59hfvQK7OYvCDj86jKtJiWeNVwNtV4S3RD+J0MeWfDK90POccC59Q1tA+kyuNI/qKpSY5ndKsriepMbwqyckMxnzQIS86+AIxTQKkTquiKUaOVi/TKEMePJMeEFXJOcTaG7xxpqJAu7XP9/ZOUU/wKgo67sYlcKIwAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",i({parentName:"span"},{className:"gatsby-resp-image-image",alt:"Architecture",title:"Cloud Database Resources Architecture",src:"/att-cloudnative/ibmcloud-pattern-guide/static/0286e443cdaefc3d2d03e2e803e1063a/1b1fd/IaC-Cloud_Services_Resources.png",srcSet:["/att-cloudnative/ibmcloud-pattern-guide/static/0286e443cdaefc3d2d03e2e803e1063a/7fc1e/IaC-Cloud_Services_Resources.png 288w","/att-cloudnative/ibmcloud-pattern-guide/static/0286e443cdaefc3d2d03e2e803e1063a/a5df1/IaC-Cloud_Services_Resources.png 576w","/att-cloudnative/ibmcloud-pattern-guide/static/0286e443cdaefc3d2d03e2e803e1063a/1b1fd/IaC-Cloud_Services_Resources.png 762w"],sizes:"(max-width: 762px) 100vw, 762px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(n.b)("p",null,"The code to build these resources can be downloaded from the GitHub repository ",Object(n.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/"}),"https://github.com/IBM/cloud-enterprise-examples/")," in the directory ",Object(n.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/08_cloud-services"}),"08_cloud-services"),"."),Object(n.b)(b,{small:!0,mdxType:"AnchorLinks"},Object(n.b)(l,{mdxType:"AnchorLink"},"Cloud Database Services"),Object(n.b)(l,{mdxType:"AnchorLink"},"MongoDB"),Object(n.b)(l,{mdxType:"AnchorLink"},"Access the database with MongoDB Compass"),Object(n.b)(l,{mdxType:"AnchorLink"},"Access to the MongoDB database with Python"),Object(n.b)(l,{mdxType:"AnchorLink"},"PostgreSQL"),Object(n.b)(l,{mdxType:"AnchorLink"},"Access to the PostgreSQL database with NodeJS"),Object(n.b)(l,{mdxType:"AnchorLink"},"Service Instances"),Object(n.b)(l,{mdxType:"AnchorLink"},"Message Queue"),Object(n.b)(l,{mdxType:"AnchorLink"},"Final Terraform code"),Object(n.b)(l,{mdxType:"AnchorLink"},"Clean up")),Object(n.b)("p",null,"As you look at the PostgreSQL & MongoDB code, you will notice the similarity.  In fact, except for the ",Object(n.b)("inlineCode",{parentName:"p"},"service")," type, they are identical.  This is because the scripts are using Resource Management Resources and managing resources for the IBM Cloud database services.  You can find out more about it ",Object(n.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-resource-mgmt-resources#resource-instance"}),"here"),"."),Object(n.b)("h2",null,"Cloud Database Services"),Object(n.b)("p",null,Object(n.b)("a",i({parentName:"p"},{href:"https://www.ibm.com/cloud/databases"}),"IBM Cloud Database")," offers many database options, with each one being useful for a particular use-case. The IBM Cloud Provider supports creation of ",Object(n.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-databases-resources"}),"Cloud Databases resources")," of several different flavors including: ",Object(n.b)("strong",{parentName:"p"},"etcd"),", ",Object(n.b)("strong",{parentName:"p"},"PostgreSQL"),", ",Object(n.b)("strong",{parentName:"p"},"Redis"),", ",Object(n.b)("strong",{parentName:"p"},"ElasticSearch"),", ",Object(n.b)("strong",{parentName:"p"},"MongoDB")," and messaging with ",Object(n.b)("strong",{parentName:"p"},"RabbitMQ"),"."),Object(n.b)("p",null,"To create a Cloud Database we use the Terraform resource ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_database"),". No matter what database flavor is provisioned, we always provide the same input parameters and get the same output parameters. The DB flavor will only affect the values of these parameters."),Object(n.b)("p",null,"The following table lists the most relevant input parameters for the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_database")," resource."),Object(n.b)("table",null,Object(n.b)("thead",{parentName:"table"},Object(n.b)("tr",{parentName:"thead"},Object(n.b)("th",i({parentName:"tr"},{align:null}),"Input parameter"),Object(n.b)("th",i({parentName:"tr"},{align:null}),"Description"))),Object(n.b)("tbody",{parentName:"table"},Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"name")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"name to identify the ",Object(n.b)("em",{parentName:"td"},"database instance"),".  The name must not include spaces. Notice that this is not the name as the database")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"plan")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"service plan that you choose for your instance. The supported values is ",Object(n.b)("inlineCode",{parentName:"td"},"standard"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"location")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"location to deploy your instance, it must match the region parameter that you specify in the provider block")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"tags")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"optional list of tags to add to your instance")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"service")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"type of Cloud Databases to create, the following services are accepted: ",Object(n.b)("inlineCode",{parentName:"td"},"databases-for-etcd"),", ",Object(n.b)("inlineCode",{parentName:"td"},"databases-for-postgresql"),", ",Object(n.b)("inlineCode",{parentName:"td"},"databases-for-mongodb"),", ",Object(n.b)("inlineCode",{parentName:"td"},"databases-for-redis"),", ",Object(n.b)("inlineCode",{parentName:"td"},"databases-for-elasticsearch")," and ",Object(n.b)("inlineCode",{parentName:"td"},"messages-for-rabbitmq"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"adminpassword")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"password for the database administrator. If not specified, additional users must be specified in a user block")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"members_memory_allocation_mb")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"amount of memory in megabytes for the database, split across all members")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"members_disk_allocation_mb")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"amount of disk space for the database, split across all members")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"members_cpu_allocation_count")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"allocates the number of specified dedicated cores to your deployment")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"backup_id")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"CRN of a backup resource to restore from. The backup must have been created by a database deployment with the same service ID. The backup is loaded after provisioning and the new deployment starts up that uses that data. A backup CRN is in the format ",Object(n.b)("inlineCode",{parentName:"td"},"crn:v1:<…>:backup:"),". If omitted, the database is provisioned empty")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"key_protect_key")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"CRN of a Key Protect root key that you want to use for disk encryption. A key protect CRN is in the format ",Object(n.b)("inlineCode",{parentName:"td"},"crn:v1:<…>:key:"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"key_protect_instance")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"CRN of a Key Protect instance that you want to use for disk encryption. A key protect CRN is in the format ",Object(n.b)("inlineCode",{parentName:"td"},"crn:v1:<…>::"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"service_endpoints")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"to enable the ",Object(n.b)("inlineCode",{parentName:"td"},"public"),", ",Object(n.b)("inlineCode",{parentName:"td"},"private"),", or both ",Object(n.b)("inlineCode",{parentName:"td"},"public-and-private")," service endpoints. The default is ",Object(n.b)("inlineCode",{parentName:"td"},"public"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"users")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"list of users to create on the database. Multiple blocks are allowed")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"users.name")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"name of the user ID to add to the database instance. The user ID must be between 5 and 32 characters")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"users.password")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"password for the user ID. The password must be between 10 and 32 characters")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"whitelist")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"list of IP addresses to allow access for the database. Multiple blocks are allowed. If not specified access from any IP is allowed")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"whitelist.address")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"The IP address or range of database client addresses to be whitelisted in CIDR format. Example: ",Object(n.b)("inlineCode",{parentName:"td"},"172.168.1.2/32"))))),Object(n.b)("p",null,"The list of output parameters is like follows:"),Object(n.b)("table",null,Object(n.b)("thead",{parentName:"table"},Object(n.b)("tr",{parentName:"thead"},Object(n.b)("th",i({parentName:"tr"},{align:null}),"Input parameter"),Object(n.b)("th",i({parentName:"tr"},{align:null}),"Description"))),Object(n.b)("tbody",{parentName:"table"},Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"id")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"CRN of the database instance")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"status")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"status of the instance")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"adminuser")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"user ID of the database administrator. Example: ",Object(n.b)("inlineCode",{parentName:"td"},"admin")," or ",Object(n.b)("inlineCode",{parentName:"td"},"root"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"version")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"database version")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"connectionstrings")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"list of ",Object(n.b)("a",i({parentName:"td"},{href:"https://cloud.ibm.com/docs/services/databases-for-postgresql?topic=databases-for-postgresql-connection-strings"}),"connection strings")," for the database for each user ID. The results are returned in pairs of the userid and string: ",Object(n.b)("inlineCode",{parentName:"td"},"connectionstrings.1.name = admin connectionstrings.1.string = postgres://admin:$PASSWORD@79226bd4-4076-4873-b5ce-b1dba48ff8c4.b8a5e798d2d04f2e860e54e5d042c915.databases.appdomain.cloud:32554/ibmclouddb?sslmode=verify-full")," Individual string parameters can be retrieved using Terraform variables and outputs ",Object(n.b)("inlineCode",{parentName:"td"},"connectionstrings.x.hosts.x.port")," and ",Object(n.b)("inlineCode",{parentName:"td"},"connectionstrings.x.hosts.x.host"))))),Object(n.b)("p",null,"The following sections will explain how to create a simple Cloud Database with ",Object(n.b)("strong",{parentName:"p"},"MongoDB")," and ",Object(n.b)("strong",{parentName:"p"},"PostgreSQL"),". To view an example of ",Object(n.b)("strong",{parentName:"p"},"etcd"),", refer to the section ",Object(n.b)("a",i({parentName:"p"},{href:"/att-cloudnative/ibmcloud-pattern-guide/iac/getting-started-terraform/remote-state"}),"Setup Terraform Remote State using etcd as backend"),"."),Object(n.b)("h2",null,"MongoDB"),Object(n.b)("p",null,"This is a simple example to create a single instance running MongoDB. The final code can be found in the directory ",Object(n.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/08_cloud-services/simple_mongodb"}),"08_cloud-services/simple_mongodb")," of the GitHub repository with all the code patterns. A full example with application setup on VSI compute can be found in the ",Object(n.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/08_cloud-services"}),"08_cloud-services")," and is discussed towards the end of this article."),Object(n.b)("p",null,"To create a MongoDB Cloud Database use the service ",Object(n.b)("inlineCode",{parentName:"p"},"databases-for-mongodb"),". Create a file to store the database definition (i.e. ",Object(n.b)("inlineCode",{parentName:"p"},"db.tf"),") with a code similar to this one:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=db.tf",path:"db.tf"}),'variable "db_admin_password" {}\n\nresource "ibm_database" "db_instance" {\n  name              = "sampledb"\n  plan              = "standard"\n  location          = "us-south"\n  service           = "databases-for-mongodb"\n  resource_group_id = data.ibm_resource_group.group.id\n\n  adminpassword                = var.db_admin_password\n  members_memory_allocation_mb = "3072"\n  members_disk_allocation_mb   = "61440"\n}\n')),Object(n.b)("p",null,"A simple ",Object(n.b)("inlineCode",{parentName:"p"},"main.tf")," code to use the previous database would be like so:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=main.tf",path:"main.tf"}),'provider "ibm" {\n  region     = "us-south"\n  generation = 2\n}\n\ndata "ibm_resource_group" "group" {\n  name = "Default"\n}\n')),Object(n.b)("p",null,"To view some important output parameters of the provisioned database create the ",Object(n.b)("inlineCode",{parentName:"p"},"output.tf")," file with these output variables:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=output.tf",path:"output.tf"}),'output "db_connection_composed" {\n  value = ibm_database.db_instance.connectionstrings.0.composed\n}\noutput "db_connection_certbase64" {\n  value = ibm_database.db_instance.connectionstrings.0.certbase64\n}\noutput "db_admin_password" {\n  value = var.db_admin_password\n}\n')),Object(n.b)("p",null,"If you need more parameters, add the following output variables to get all the parameters, then add variables with the values of the parameters of the ",Object(n.b)("inlineCode",{parentName:"p"},"connectionstrings")," or ",Object(n.b)("inlineCode",{parentName:"p"},"db_instance")," JSON objects."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl"}),'output "db_connection_string" {\n  value = ibm_database.db_instance.connectionstrings.0\n}\noutput "instance" {\n  value = ibm_database.db_instance\n}\n')),Object(n.b)("p",null,"To define the value of the admin password variable export the variable ",Object(n.b)("inlineCode",{parentName:"p"},"TF_VAR_db_admin_password")," with a password with 10-32 characters or use the following command to generate a random password. The password will be used by the URI in the variable ",Object(n.b)("inlineCode",{parentName:"p"},"PASSWORD"),", so we are exporting both."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"export PASSWORD=$(LC_CTYPE=C tr -dc 'a-zA-Z0-9' < /dev/urandom | head -c 32)\nexport TF_VAR_db_admin_password=$PASSWORD\n")),Object(n.b)("p",null,"To create the database just execute the following terraform commands:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"terraform init\nterraform plan\nterraform apply\n")),Object(n.b)("p",null,"You’ll see the output of the last command with the connection string URI with the variable ",Object(n.b)("inlineCode",{parentName:"p"},"db_connection_composed")," and the CA certificate encoded with base64 in the variable ",Object(n.b)("inlineCode",{parentName:"p"},"db_connection_certbase64"),". To get the output varibles again use the command ",Object(n.b)("inlineCode",{parentName:"p"},"terraform output"),"."),Object(n.b)("p",null,"You’ll need to save the output variables into environment variables and the certificate to a file executing these commands. In order to interpolate the ",Object(n.b)("inlineCode",{parentName:"p"},"PASSWORD")," variable into the ",Object(n.b)("inlineCode",{parentName:"p"},"APP_MONGODB_URI")," variable you have to use the ",Object(n.b)("inlineCode",{parentName:"p"},"eval")," command like so."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"terraform output db_connection_certbase64 | base64 --decode > db_ca.crt\nexport PASSWORD=$(terraform output db_admin_password)\nexport APP_MONGODB_URI=$(eval 'echo \"'$(terraform output db_connection_composed)'\"')\necho $APP_MONGODB_URI\n")),Object(n.b)("p",null,"All you need to conect to the database is the conection URI, from the environment variable ",Object(n.b)("inlineCode",{parentName:"p"},"APP_MONGODB_URI"),", and the CA Certificate, stored in the file ",Object(n.b)("inlineCode",{parentName:"p"},"./db_ca.crt"),"."),Object(n.b)("h2",null,"Access the database with MongoDB Compass"),Object(n.b)("p",null,"Let’s use the client MongoDB Compass to access the new provisioned database. Download and install the ",Object(n.b)("a",i({parentName:"p"},{href:"https://www.mongodb.com/try/download/compass"}),"MongoDB Compass")," application for your platform. Alternatively you can use the ",Object(n.b)("inlineCode",{parentName:"p"},"brew")," command on Mac OS X to install it."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"brew cask install mongodb-compass\n")),Object(n.b)("p",null,"Open MongoDB Compass and you’ll see the new connection screen. Copy and paste the connection URI from the environment variable ",Object(n.b)("inlineCode",{parentName:"p"},"APP_MONGODB_URI")," in the ",Object(n.b)("strong",{parentName:"p"},"Paste your connection string")," field."),Object(n.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(n.b)("span",i({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"43.05555555555555%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNklEQVQoz52Sz07DMAzG87RceBUOvAtC4sABIYTEgRdA3WBbtmT9k3VtkmZL2w87YmgIMWlY+tVfHNmJ3YjZfIHlSkHKJRbMQqLeNljpHO9zibyo4LsA6zy879CRZkL4De8LpTT0Ok+wVnqdCnIhLlpWG7TWpYJma/GhN5gRk5XBVG2Qffk3WaGifTGOwECfYRjBmun7gfyY4DivY4wIuz2sD4n2CF43jrT1EMYYFHmOuq5RFAVKpiyhtYapqhTTSsG2bTrglPEoBPdurUVLCcyxPtA0TYp77ymp+4bXu7jHnm4f+z7NWkQKOOd+JLH/q/DBb4lALR6bp0ME/mGHxu/lKy4ernD5eI272QsQwT+FBz+cRU/tsU2MxE32hNvpMzLScRch+DmciyNaGlMMdCWuTbDm2CfFa7TBm/Pj3QAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",i({parentName:"span"},{className:"gatsby-resp-image-image",alt:"mongodb compass 1",title:"mongodb compass 1",src:"/att-cloudnative/ibmcloud-pattern-guide/static/d559544361f987f23e3643a7d75c099b/3cbba/mongodb_compass_1.png",srcSet:["/att-cloudnative/ibmcloud-pattern-guide/static/d559544361f987f23e3643a7d75c099b/7fc1e/mongodb_compass_1.png 288w","/att-cloudnative/ibmcloud-pattern-guide/static/d559544361f987f23e3643a7d75c099b/a5df1/mongodb_compass_1.png 576w","/att-cloudnative/ibmcloud-pattern-guide/static/d559544361f987f23e3643a7d75c099b/3cbba/mongodb_compass_1.png 1152w","/att-cloudnative/ibmcloud-pattern-guide/static/d559544361f987f23e3643a7d75c099b/a5a5c/mongodb_compass_1.png 1244w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(n.b)("p",null,"Click on ",Object(n.b)("strong",{parentName:"p"},"Fill in connection fields individually"),", then select the ",Object(n.b)("strong",{parentName:"p"},"More Options")," tab. Select ",Object(n.b)("strong",{parentName:"p"},"Server Validation")," in the ",Object(n.b)("strong",{parentName:"p"},"SSL")," field, then select the ",Object(n.b)("inlineCode",{parentName:"p"},"db_ca.crt")," file in the ",Object(n.b)("strong",{parentName:"p"},"Certificate Authority")," field."),Object(n.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(n.b)("span",i({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"84.72222222222221%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACBElEQVQ4y5VUy47UMBDMn3PiNzhw48AvICFxQOLGAQmJWQ2zk9dkNokT52U7Kbqc8W6WmUWspVLHsV1d/bCjLMuR5yekYjOxSZqiOJ9RqwZJdvJodYeuHx6hBcMwYBxGsU/o5X9EwjhJhSjz9v4YIz8VKGuFY5LhmOZQrYbueiFe0fU9krPC77zGQRBsqTSiyRg4N8PNM+Z58ZbzRb7DsMZimgy4l9aI1f0IpYcV3WobcRYZ2YxlEbk9tG7hrMNoJ+yzGLvjAXfJEZMznniRfQG3BsOOjFfoxPOEcRy9snrSuFMp9irDropRjo04sjACu4EJuHD0K6F9ciGei6JAVVZQZY1BijEbh0Ypf2D2aXkZvRTqkTCE0XUdmrZB0zSS/E429TJvnynbgo6okN/PFAZCElHlWdAKEduD//6ljGRM2fA3IRe3Y/YVXxUwvzzE+VZdwBryDYVhcFNd1776SnJYlqV0gb5yyHMkp8MrhVVV4Sy3hJZhkyxUP1iu8TadZJ3zlWi4nUMusChho720RDhEMK8kZV63hO6loqwNuhIHVSS91dC+ILPk2K636CrkAOaKOaMKhk2EAgVYxxu2TTpCH/7ftdquh264b0/4uPuMD78+4Wd1gJscIubptWO5SPvxsMfbb+/x5us7fIm/yysCRHzfKPW14DkzSnRm8bCT9U/cH+d3K3YR1ItcAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",i({parentName:"span"},{className:"gatsby-resp-image-image",alt:"mongodb compass 2",title:"mongodb compass 2",src:"/att-cloudnative/ibmcloud-pattern-guide/static/17b7f1da25ec8199a85b4f895416f93f/3cbba/mongodb_compass_2.png",srcSet:["/att-cloudnative/ibmcloud-pattern-guide/static/17b7f1da25ec8199a85b4f895416f93f/7fc1e/mongodb_compass_2.png 288w","/att-cloudnative/ibmcloud-pattern-guide/static/17b7f1da25ec8199a85b4f895416f93f/a5df1/mongodb_compass_2.png 576w","/att-cloudnative/ibmcloud-pattern-guide/static/17b7f1da25ec8199a85b4f895416f93f/3cbba/mongodb_compass_2.png 1152w","/att-cloudnative/ibmcloud-pattern-guide/static/17b7f1da25ec8199a85b4f895416f93f/34524/mongodb_compass_2.png 1250w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(n.b)("p",null,"Create a database clicking on the ",Object(n.b)("strong",{parentName:"p"},"CREATE DATABASE")," button. Name the database ",Object(n.b)("inlineCode",{parentName:"p"},"demodb")," and the collection ",Object(n.b)("inlineCode",{parentName:"p"},"users"),"."),Object(n.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1010px"}},"\n      ",Object(n.b)("span",i({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"100.69444444444444%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACaklEQVQ4y52US2/TQBDH/SE5cEVc+BYcuMEBCVFB1YIQFBUqIRWohEDQRwQHlLRJqdqQh2PHjzi2GzuxYyfx68/sOgkgFdF6pZ/+6931eGZnxkLl6BCqqkKSpCWyLMMwjEIIXbmL4XAI27ZhWRb6/T4GgwGKDoF5d9FIkqQQgiiKGJGHruPAdV34nocsywp5l6ZpbpCFa/R6PGSHDBf1Lo7jPOSIJq47RDr3jH3pqjCDzI4gyxLGvg9vNILve3yeZWkh+B022yK6PQuy1oekGeioBsazhEivzDQigw1JxSicwQ+nPFwWdJQCsyTDNE7/yyTKlTkxDClkqavC9ScwbAe268McjLgOx1MEdDgkgjnhBSzPzJhx8lCjpEzCgLKsw6GCtkwTg/NzhEFQoGySPMue5/O2YV1yTsZ0Tef4PEHZJcmbYdkpURTxOkqIOM7nLHNX8pAZPBE7KPUd7Kom9jQLuwTTfd3mumCxf6CzPWK+/oXWd1XapzU7nECoNNt4XlewVmtj/VjE6lGuT086ePKjw5WxVhOxUm5htSri0WEbK5UWnp1KeFGXsVHvYqOpQPMDCDWqww/0hbeivuRdh9Hj8/dSD9ti/vy6rmKLeHWmYPNUwY5s4JNu4qNmYqdLv69xSL8vRUFM8Yd0ZxO6gyXxQuPl8zTJmaU57J0g+g1vPYUMshHPk7JITPLHfKFpkvKLz0jB8pVmf2lGKphUd5cdFpWU73iomD9xfe8Obpbu4UbpLm59u49rn2+jPGhAqFarvP40TYOu6/+ElddZvY5Wo4XvZ1U8PNjE49IWZ/3rGzzYf4ly4xi/AJLH7JEyqiZaAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",i({parentName:"span"},{className:"gatsby-resp-image-image",alt:"mongodb compass 3",title:"mongodb compass 3",src:"/att-cloudnative/ibmcloud-pattern-guide/static/256453afcaa6f38f9ca096af38c24c05/96101/mongodb_compass_3.png",srcSet:["/att-cloudnative/ibmcloud-pattern-guide/static/256453afcaa6f38f9ca096af38c24c05/7fc1e/mongodb_compass_3.png 288w","/att-cloudnative/ibmcloud-pattern-guide/static/256453afcaa6f38f9ca096af38c24c05/a5df1/mongodb_compass_3.png 576w","/att-cloudnative/ibmcloud-pattern-guide/static/256453afcaa6f38f9ca096af38c24c05/96101/mongodb_compass_3.png 1010w"],sizes:"(max-width: 1010px) 100vw, 1010px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(n.b)("p",null,"Click on the ",Object(n.b)("strong",{parentName:"p"},"demodb")," database, click on the ",Object(n.b)("strong",{parentName:"p"},"users")," collection, then on ADD DATA > Insert Document to add any data you want, like the following example:"),Object(n.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(n.b)("span",i({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"22.916666666666668%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4UlEQVQY032PSU4DMRBFff8TsOEMESdgyxYBG2CBorTSuJ14nun+VDkgZYGw9PXL5ecahNQJ+mxQa8W2bUN81nUdzvffOKUEay1KKcg5jz8lF/RS0SiOMUK8TnvMRiER4L0fUP15bL1TkYwQAlrrCJRzxPT+NYozE8knu8An4muDeJ7e8KGPA+auDHCRyxQk8kITcMzO4gYxJiyLwmE+4ubxDk+HdzjjIG4fdti93MM4i9NZQ6kTtDY0SfhT1nnMnxJSLpBUkHljPIy95IVTBsUn6hppSlqDVyT/T8xc6zr/DZxMf3drZF7LAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",i({parentName:"span"},{className:"gatsby-resp-image-image",alt:"mongodb compass 4",title:"mongodb compass 4",src:"/att-cloudnative/ibmcloud-pattern-guide/static/ee6a9127e0b490d3b67b4e5fe67210c4/3cbba/mongodb_compass_4.png",srcSet:["/att-cloudnative/ibmcloud-pattern-guide/static/ee6a9127e0b490d3b67b4e5fe67210c4/7fc1e/mongodb_compass_4.png 288w","/att-cloudnative/ibmcloud-pattern-guide/static/ee6a9127e0b490d3b67b4e5fe67210c4/a5df1/mongodb_compass_4.png 576w","/att-cloudnative/ibmcloud-pattern-guide/static/ee6a9127e0b490d3b67b4e5fe67210c4/3cbba/mongodb_compass_4.png 1152w","/att-cloudnative/ibmcloud-pattern-guide/static/ee6a9127e0b490d3b67b4e5fe67210c4/0b124/mongodb_compass_4.png 1728w","/att-cloudnative/ibmcloud-pattern-guide/static/ee6a9127e0b490d3b67b4e5fe67210c4/65838/mongodb_compass_4.png 2050w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-json"}),'[\n  {\n    "_id": "5ee428b13265d9083baa0259",\n    "index": 0,\n    "picture": "http://placehold.it/32x32",\n    "age": 21,\n    "name": "Dale Duffy",\n    "gender": "male",\n    "email": "daleduffy@dognosis.com"\n  },\n  {\n    "_id": "5ee428b19eeb7916a4943a64",\n    "index": 1,\n    "picture": "http://placehold.it/32x32",\n    "age": 36,\n    "name": "Price West",\n    "gender": "male",\n    "email": "pricewest@dognosis.com"\n  },\n  {\n    "_id": "5ee428b198517601184ee994",\n    "index": 2,\n    "picture": "http://placehold.it/32x32",\n    "age": 29,\n    "name": "Arline Gordon",\n    "gender": "female",\n    "email": "arlinegordon@dognosis.com"\n  },\n  {\n    "_id": "5ee428b1cd9893fad62cf901",\n    "index": 3,\n    "picture": "http://placehold.it/32x32",\n    "age": 37,\n    "name": "Mathis Gould",\n    "gender": "male",\n    "email": "mathisgould@dognosis.com"\n  },\n  {\n    "_id": "5ee428b19e46e16ef1284030",\n    "index": 4,\n    "picture": "http://placehold.it/32x32",\n    "age": 30,\n    "name": "Rosemarie Morton",\n    "gender": "female",\n    "email": "rosemariemorton@dognosis.com"\n  }\n]\n')),Object(n.b)("p",null,"There is more information about how to use MongoDB Compass ",Object(n.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/databases-for-mongodb?topic=databases-for-mongodb-getting-started"}),"with the IBM Cloud Database")," or about how to use ",Object(n.b)("a",i({parentName:"p"},{href:"https://docs.mongodb.com/compass/current/"}),"MongoDB Compass")," in general."),Object(n.b)("h2",null,"Access to the MongoDB database with Python"),Object(n.b)("p",null,"For simplicity let’s create this code in Python to use the conection string and connect to the database. A similar code can be made in any other programming language."),Object(n.b)("p",null,"In this example we’ll use the ",Object(n.b)("a",i({parentName:"p"},{href:"https://pypi.org/project/pymongo/"}),"pymongo")," package and a JSON file with mock data to import into the database. All the code is located in the directory ",Object(n.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/08_cloud-services/simple_mongodb"}),"08_cloud-services/simple_mongodb")," of the GitHub repository with all the code patterns."),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"pymongo")," package requires the connection URI, obtained from the environment variable ",Object(n.b)("inlineCode",{parentName:"p"},"APP_MONGODB_URI")," and the CA certificate from the file ",Object(n.b)("inlineCode",{parentName:"p"},"db_ca.crt"),", like so."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-python"}),"from pymongo import MongoClient\nimport os\n\nmongodb_uri = os.environ.get('APP_MONGODB_URI')\n\nclient = MongoClient(mongodb_uri,\n                     ssl=True,\n                     ssl_ca_certs=\"./db_ca.crt\")\n")),Object(n.b)("p",null,"The rest of the application is a sample code to insert many documents or just one, to find documents and query the database. Similar sample code can be found in the pymongo ",Object(n.b)("a",i({parentName:"p"},{href:"https://pypi.org/project/pymongo/"}),"documentation")," or in this ",Object(n.b)("a",i({parentName:"p"},{href:"https://www.w3schools.com/python/python_mongodb_getstarted.asp"}),"tutorial"),". The entire code is shown below and also can be downloaded from ",Object(n.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/08_cloud-services/simple_mongodb/app.py"}),"here"),"."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-python",metastring:"path=app.py",path:"app.py"}),'from pymongo import MongoClient\nimport json\nimport os\n\nmongodb_uri = os.environ.get(\'APP_MONGODB_URI\')\n\nclient = MongoClient(mongodb_uri,\n                     ssl=True,\n                     ssl_ca_certs="./db_ca.crt")\n\ndbnames = client.list_database_names()\n\ndb = client[\'demodb\']\nbooks = db[\'books\']\n\nif not books.find_one():\n    with open(\'./db.json\') as f:\n        data = json.load(f)\n    books.insert_many(data[\'books\'])\n\nnew_book = {\n    "isbn": "9781449325862",\n    "title": "Git Pocket Guide",\n    "subtitle": "A Working Introduction",\n    "author": "Richard E. Silverman",\n    "published": "2013-08-02T00:00:00.000Z",\n    "publisher": "O\'Reilly Media",\n    "pages": 234,\n    "description": "This pocket guide is the perfect on-the-job companion to Git, the distributed version control system. It provides a compact, readable introduction to Git for new users, as well as a reference to common commands and procedures for those of you with Git experience.",\n    "website": "http://chimera.labs.oreilly.com/books/1230000000561/index.html"\n}\n\nif books.count_documents({"isbn": new_book[\'isbn\']}) == 0:\n    book = books.insert_one(new_book)\n    print("The new book has been inserted. ID = ", book.inserted_id)\n\nprint("Books:")\nfor book in books.find({}, {"title": 1}):\n    print("\\t", book)\n\nquery = {"publisher": "O\'Reilly Media"}\nprint("O\'Reilly Media\'s Books:")\nfor book in books.find(query, {"title": 1, "publisher": 1}):\n    print("\\t", book)\n\nclient.close()\n')),Object(n.b)("h2",null,"PostgreSQL"),Object(n.b)("p",null,"This is another simple example to create a single instance running PostgreSQL. The final code can be found in the directory ",Object(n.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/08_cloud-services/simple_postgresql"}),"08_cloud-services/simple_postgresql")," of the GitHub repository with all the code patterns."),Object(n.b)("p",null,"To create a PostgreSQL Cloud Database use the service ",Object(n.b)("inlineCode",{parentName:"p"},"databases-for-postgresql"),". Create a file to store the database definition (i.e. ",Object(n.b)("inlineCode",{parentName:"p"},"db.tf"),") with a code similar to this one:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=db.tf",path:"db.tf"}),'resource "ibm_database" "db_instance" {\n  name              = "sampledb"\n  plan              = "standard"\n  location          = "us-south"\n  service           = "databases-for-postgresql"\n  resource_group_id = data.ibm_resource_group.group.id\n\n  adminpassword                = "P@ssW0rd"\n  members_memory_allocation_mb = "3072"\n  members_disk_allocation_mb   = "61440"\n}\n')),Object(n.b)("p",null,"A simple ",Object(n.b)("inlineCode",{parentName:"p"},"main.tf")," code to use the previous database would be like so:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=main.tf",path:"main.tf"}),'provider "ibm" {\n  region             = "us-south"\n  generation         = 2\n}\n\ndata "ibm_resource_group" "group" {\n  name = "Default"\n}\n')),Object(n.b)("p",null,"To view some important output parameters of the provisioned database create the ",Object(n.b)("inlineCode",{parentName:"p"},"output.tf")," file with these output variables:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=output.tf",path:"output.tf"}),'output "db_connection_composed" {\n  value = ibm_database.db_instance.connectionstrings.0.composed\n}\noutput "db_connection_certbase64" {\n  value = ibm_database.db_instance.connectionstrings.0.certbase64\n}\n')),Object(n.b)("p",null,"If you need more parameters, add the following output variables to get all the parameters, then add variables with the values of the parameters of the ",Object(n.b)("inlineCode",{parentName:"p"},"connectionstrings")," or ",Object(n.b)("inlineCode",{parentName:"p"},"db_instance")," JSON objects."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl"}),'output "db_connection_string" {\n  value = ibm_database.db_instance.connectionstrings.0\n}\noutput "instance" {\n  value = ibm_database.db_instance\n}\n')),Object(n.b)("p",null,"To define the value of the admin password variable export the variable ",Object(n.b)("inlineCode",{parentName:"p"},"TF_VAR_db_admin_password")," with a password with 10-32 characters or use the following command to generate a random password. The password will be used by the URI in the variable ",Object(n.b)("inlineCode",{parentName:"p"},"PASSWORD"),", so we are exporting both."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"export PASSWORD=$(LC_CTYPE=C tr -dc 'a-zA-Z0-9' < /dev/urandom | head -c 32)\nexport TF_VAR_db_admin_password=$PASSWORD\n")),Object(n.b)("p",null,"To create the database just execute the following terraform commands:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"terraform init\nterraform plan\nterraform apply\n")),Object(n.b)("p",null,"You’ll see the output of the last command with the connection string URI with the variable ",Object(n.b)("inlineCode",{parentName:"p"},"db_connection_composed")," and the CA certificate encoded with base64 in the variable ",Object(n.b)("inlineCode",{parentName:"p"},"db_connection_certbase64"),". To get the output varibles again use the command ",Object(n.b)("inlineCode",{parentName:"p"},"terraform output"),"."),Object(n.b)("p",null,"You’ll need to save the output variables into environment variables and the certificate to a file executing these commands. In order to interpolate the ",Object(n.b)("inlineCode",{parentName:"p"},"PASSWORD")," variable into the ",Object(n.b)("inlineCode",{parentName:"p"},"APP_POSTGRESQL_URI")," variable you have to use the ",Object(n.b)("inlineCode",{parentName:"p"},"eval")," command like so."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"terraform output db_connection_certbase64 | base64 --decode > db_ca.crt\nexport PASSWORD=$(terraform output db_admin_password)\nexport APP_POSTGRESQL_URI=$(eval 'echo \"'$(terraform output db_connection_composed)'\"')\n")),Object(n.b)("p",null,"The database name in the URI is ",Object(n.b)("inlineCode",{parentName:"p"},"ibmclouddb"),", assumig the DB name is ",Object(n.b)("inlineCode",{parentName:"p"},"demo")," let’s use the ",Object(n.b)("inlineCode",{parentName:"p"},"sed")," command to change it, like so:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),'export DB_NAME=demo\nexport APP_POSTGRESQL_URI=$(echo $APP_POSTGRESQL_URI | sed "s|/ibmclouddb?|/$DB_NAME?|")\necho $APP_POSTGRESQL_URI\n')),Object(n.b)("p",null,"All you need to conect to the database is the conection URI, from the environment variable ",Object(n.b)("inlineCode",{parentName:"p"},"APP_POSTGRESQL_URI"),", and the CA Certificate, stored in the file ",Object(n.b)("inlineCode",{parentName:"p"},"./db_ca.crt"),"."),Object(n.b)("h2",null,"Access to the PostgreSQL database with NodeJS"),Object(n.b)("p",null,"For simplicity let’s create this code in NodeJS to use the conection string and connect to the database. A similar code can be made in any other programming language."),Object(n.b)("p",null,"Let’s install the PostgreSQL client ",Object(n.b)("a",i({parentName:"p"},{href:"https://www.pgadmin.org/download/"}),"pgAdmin")," which is GUI/Web client. It can also be installed on Mac OS X with ",Object(n.b)("inlineCode",{parentName:"p"},"brew"),"."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"brew cask install pgadmin4\n")),Object(n.b)("p",null,"To connect to the Cloud Database using pgAdmin read the ",Object(n.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/databases-for-postgresql?topic=databases-for-postgresql-getting-started"}),"documentation")," or follow this quick instructions:"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},"Add a New Server with any given name (i.e. ",Object(n.b)("inlineCode",{parentName:"li"},"ibmcloud"),")"),Object(n.b)("li",{parentName:"ol"},"Go to the Connection tab, enter the ",Object(n.b)("strong",{parentName:"li"},"Host name")," and ",Object(n.b)("strong",{parentName:"li"},"Port")," from the ",Object(n.b)("inlineCode",{parentName:"li"},"APP_POSTGRESQL_URI")," variable."),Object(n.b)("li",{parentName:"ol"},"Enter the ",Object(n.b)("strong",{parentName:"li"},"Password")," from the ",Object(n.b)("inlineCode",{parentName:"li"},"PASSWORD")," variable."),Object(n.b)("li",{parentName:"ol"},"Go to the SSL tab, click on the 3 dots to select the ",Object(n.b)("inlineCode",{parentName:"li"},"db_ca.crt")," file under the ",Object(n.b)("strong",{parentName:"li"},"Root certificate")," field."),Object(n.b)("li",{parentName:"ol"},"Click on the ",Object(n.b)("strong",{parentName:"li"},"Save")," button.")),Object(n.b)("p",null,"Using the GUI or the Query Tool (",Object(n.b)("strong",{parentName:"p"},"Tools")," > ",Object(n.b)("strong",{parentName:"p"},"Query Tool"),"), create the database ",Object(n.b)("inlineCode",{parentName:"p"},"demo"),"."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-sql"}),"CREATE DATABASE demo;\n")),Object(n.b)("p",null,"Select the new database with the right click to open the ",Object(n.b)("strong",{parentName:"p"},"Query Tool")," on the new database. Create the table ",Object(n.b)("inlineCode",{parentName:"p"},"users")," and insert a few records using the following SQL instruction:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-sql"}),"CREATE TABLE users (\n  ID SERIAL PRIMARY KEY,\n  name VARCHAR(30),\n  email VARCHAR(30),\n  age INT\n);\n\nINSERT INTO users (name, email, age)\n  VALUES\n    ('Dale Duffy', 'daleduffy@dognosis.com', 21),\n    ('Price West', 'pricewest@dognosis.com', 36);\n")),Object(n.b)("p",null,"Verify the data either using the GUI or executing the following SQL instructions"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-sql"}),"SELECT * FROM users;\n")),Object(n.b)("p",null,"Create a new NodeJS application and install the ",Object(n.b)("inlineCode",{parentName:"p"},"pg")," packages."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"mkdir app\ncd app\nnpm init\nnpm install pg\n")),Object(n.b)("p",null,"Create the ",Object(n.b)("inlineCode",{parentName:"p"},"index.js")," with the following code to connect to the database, get the list of users and insert a new one."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-javascript"}),'const { Pool, Client } = require("pg");\nconst { readFileSync } = require("fs");\nconst { join } = require("path");\n\nconst connectionString = process.env.APP_POSTGRESQL_URI;\nconst caCertPath = join(__dirname, "..", "db_ca.crt");\nconst caCert = readFileSync(caCertPath);\n\n(async () => {\n  const pool = new Pool({\n    connectionString: connectionString,\n    ssl: {\n      ca: caCert,\n      rejectUnauthorized: true,\n    },\n  });\n\n  const resBefore = await pool.query("SELECT * FROM users");\n  console.info(resBefore.rows);\n\n  pool.query("INSERT INTO users (name, email, age) VALUES ($1, $2, $3)", [\n    "Arline Gordon",\n    "arlinegordon@dognosis.com",\n    29,\n  ]);\n\n  const resAfter = await pool.query("SELECT * FROM users");\n  console.info(resAfter.rows);\n\n  await pool.end();\n})();\n')),Object(n.b)("p",null,"Execute yuour code with the command:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"node .\n")),Object(n.b)("p",null,"Refer to the ",Object(n.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/databases-for-postgresql"}),"documentation")," to know more about PostgreSQL database on IBM Cloud."),Object(n.b)("h2",null,"Service Instances"),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_resource_instance")," resource can be used to create, update or delete any of the offered services by IBM Cloud. You can retrieve list of offered services by installing the ",Object(n.b)("inlineCode",{parentName:"p"},"catalogs-management")," CLI plug-in and running the ",Object(n.b)("inlineCode",{parentName:"p"},"service-marketplace")," or ",Object(n.b)("inlineCode",{parentName:"p"},"search")," subcommands of such plugin."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"ibmcloud plugin install catalogs-management\n\nibmcloud catalog search\n\nibmcloud catalog service-marketplace\nibmcloud catalog service-marketplace | grep message\n\nibmcloud catalog service mqcloud\n")),Object(n.b)("p",null,"You can use the same plugin to create the service however, in this page we’ll cover how to manage the service with Terraform, using the resource ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_resource_instance"),"."),Object(n.b)("p",null,"The following table list the most relevant input parameters for the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_resource_instance")," resource."),Object(n.b)("table",null,Object(n.b)("thead",{parentName:"table"},Object(n.b)("tr",{parentName:"thead"},Object(n.b)("th",i({parentName:"tr"},{align:null}),"Input parameter"),Object(n.b)("th",i({parentName:"tr"},{align:null}),"Description"))),Object(n.b)("tbody",{parentName:"table"},Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"name")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"name to identify the resource instance")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"service")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"name of the service offering")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"plan")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"name of the plan type supported by service. You can retrieve the value by running the ",Object(n.b)("inlineCode",{parentName:"td"},"ibmcloud catalog service <servicename>")," command")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"location")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"target location or environment to create the resource instance")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"resource_group_id")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"ID of the resource group where you want to create the service. You can retrieve the value from data source ",Object(n.b)("inlineCode",{parentName:"td"},"ibm_resource_group"),". By default uses the Default resource group")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",i({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"parameters")),Object(n.b)("td",i({parentName:"tr"},{align:null}),"Arbitrary parameters to create instance. The value must be a JSON object")))),Object(n.b)("h2",null,"Message Queue"),Object(n.b)("p",null,"In this section we’ll see an example to create a Message & Queue service using the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_resource_instance")," resource. Create the file ",Object(n.b)("inlineCode",{parentName:"p"},"mq.tf")," with the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_resource_instance")," resource to create an ",Object(n.b)("inlineCode",{parentName:"p"},"mqcloud")," service."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=mq.rf",path:"mq.rf"}),'resource "ibm_resource_instance" "resource_instance" {\n  name              = "mq-instance-test"\n  service           = "mqcloud"\n  plan              = "default"\n  location          = "us-south"\n  resource_group_id = data.ibm_resource_group.group.id\n  tags              = ["message queue", "testmq"]\n\n  timeouts {\n    create = "15m"\n    update = "15m"\n    delete = "15m"\n  }\n}\n')),Object(n.b)("p",null,"A simple ",Object(n.b)("inlineCode",{parentName:"p"},"main.tf")," file to use the above code would be like this:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=main.tf",path:"main.tf"}),'provider "ibm" {\n  region     = "us-south"\n  generation = 2\n}\n\ndata "ibm_resource_group" "group" {\n  name = "Default"\n}\n')),Object(n.b)("p",null,"Execute this code with the following terraform commands:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"terraform init\nterraform plan\nterraform apply\n")),Object(n.b)("p",null,"Refer to the ",Object(n.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/mqcloud"}),"documentation")," to know how to use the MQ service from CLI, the Web Console or your own application."),Object(n.b)("h2",null,"Final Terraform code"),Object(n.b)("p",null,"The only cloud database service used in the complete demo application is MongoDB. You can download the code from the GitHub repository ",Object(n.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/"}),"https://github.com/IBM/cloud-enterprise-examples/")," in the directory ",Object(n.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/08_cloud-services"}),"08_cloud-services"),". This code builds off the compute example by adding the following resources and code."),Object(n.b)("p",null,"The database definition file ",Object(n.b)("inlineCode",{parentName:"p"},"db.tf")," using the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_database")," resource."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=db.tf",path:"db.tf"}),'resource "ibm_database" "iac_app_db_instance" {\n  name              = var.db_name\n  plan              = var.db_plan\n  location          = var.region\n  service           = "databases-for-mongodb"\n  resource_group_id = data.ibm_resource_group.group.id\n\n  adminpassword                = var.db_admin_password\n  members_memory_allocation_mb = var.db_memory_allocation\n  members_disk_allocation_mb   = var.db_disk_allocation\n}\n')),Object(n.b)("p",null,"Appending the new defined variables in the ",Object(n.b)("inlineCode",{parentName:"p"},"variables.tf")," file."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=variables.tf",path:"variables.tf"}),'variable "db_plan" {\n  default = "standard"\n}\nvariable "db_name" {\n  default = "moviedb"\n}\nvariable "db_admin_password" {\n  default = "inSecureP@55w0rd"\n}\nvariable "db_memory_allocation" {\n  default = "3072"\n}\nvariable "db_disk_allocation" {\n  default = "61440"\n}\n')),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"compute.tf")," file has a new Cloud-Init code in the VSI, like so:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=compute.tf",path:"compute.tf"}),"resource \"ibm_is_instance\" \"iac_app_instance\" {\n  ...\n\n  user_data = <<-EOUD\n            #!/bin/bash\n            mkdir -p /app\n\n            # Application script and dependencies\n            echo '${data.local_file.requirements.content_base64}' | base64 --decode > /app/requirements.txt\n            echo '${data.local_file.app.content_base64}' | base64 --decode > /app/app.py\n            # Script and database to initially import\n            echo '${data.local_file.db.content_base64}' | base64 --decode > /app/db.json\n            echo '${data.local_file.import.content_base64}' | base64 --decode > /app/import.py\n            # Configuration and credentials\n            echo '${ibm_database.iac_app_db_instance.connectionstrings.0.certbase64}' | base64 --decode > /app/db_certificate.cert\n            export PASSWORD=${var.db_admin_password}\n            export APP_MONGODB_URI=\"${ibm_database.iac_app_db_instance.connectionstrings.0.composed}\"\n            export APP_PORT=${var.port}\n\n\n            # https://askubuntu.com/questions/1154892/prevent-question-restart-services-during-package-upgrades-without-asking\n            echo '* libraries/restart-without-asking boolean true' | debconf-set-selections\n\n            # Python3 is installed by default, pip3 is not\n            apt update\n            apt install -y python3-pip\n\n            # Setup and initialize the DB\n            cd /app\n            pip3 install -r requirements.txt\n            python3 import.py\n\n            # Start up the application\n            python3 app.py &\n            EOUD\n\n  ...\n}\n")),Object(n.b)("p",null,"In order to have access to the applications and dependencies file listed below we need to the fine the following terraform data sources with the files content."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=app.tf",path:"app.tf"}),'data "local_file" "app" {\n  filename = "${path.module}/app/app.py"\n}\n\ndata "local_file" "import" {\n  filename = "${path.module}/app/import.py"\n}\n\ndata "local_file" "requirements" {\n  filename = "${path.module}/app/requirements.txt"\n}\n\ndata "local_file" "db" {\n  filename = "${path.module}/app/db.min.json"\n}\n')),Object(n.b)("p",null,"And these files are in the ",Object(n.b)("inlineCode",{parentName:"p"},"app/")," folder. The ",Object(n.b)("inlineCode",{parentName:"p"},"app/app.py")," file is the API application using ",Object(n.b)("inlineCode",{parentName:"p"},"flask"),", ",Object(n.b)("inlineCode",{parentName:"p"},"flask-restful")," and ",Object(n.b)("inlineCode",{parentName:"p"},"flask_mongoengine")," packages."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-python",metastring:"path=app/app.py",path:"app/app.py"}),"from flask import Flask, Response, request\nfrom flask_restful import Api, Resource\nfrom flask_mongoengine import MongoEngine\nfrom datetime import datetime\nimport json\nimport os\nimport logging\nimport ssl\n\nlogging.basicConfig(filename='app.log',\n                    level=logging.DEBUG)\nmongodb_uri = os.environ.get('APP_MONGODB_URI')\nif not mongodb_uri:\n    mongodb_uri = 'mongodb://localhost/moviedb'\nport = os.environ.get('APP_PORT')\nif not port:\n    port = '8080'\napp = Flask(__name__)\napp.config['MONGODB_SETTINGS'] = {\n    'MONGODB_HOST': mongodb_uri,\n    'MONGODB_DB': 'moviedb',\n    'MONGODB_SSL': True,\n    'MONGODB_SSL_CERT_REQS': ssl.CERT_REQUIRED,\n    'MONGODB_SSL_CA_CERTS': '/app/db_certificate.cert'\n}\napi = Api(app)\ndb = MongoEngine()\ndb.init_app(app)\n\nclass Movie(db.Document):\n    title = db.StringField(required=True)\n    titleSort = db.StringField()\n    originalTitle = db.StringField()\n    contentRating = db.StringField()\n    rating = db.FloatField()\n    ratingImage = db.StringField()\n    audienceRating = db.FloatField()\n    audienceRatingImage = db.StringField()\n    hasPremiumPrimaryExtra = db.IntField()\n    summary = db.StringField(required=False)\n    year = db.IntField(required=False)\n    tagline = db.StringField()\n    duration = db.IntField(required=False)\n    originallyAvailableAt = db.StringField(required=False)\n    addedAt = db.IntField(\n        default=datetime.timestamp(datetime.now()), required=False)\n    updatedAt = db.IntField(\n        default=datetime.timestamp(datetime.now()), required=False)\n    genre = db.StringField(required=True)\n    # genre = db.ListField(required=True)\n    director = db.ListField(db.StringField(), required=True)\n    writer = db.ListField(db.StringField(), required=False)\n    country = db.StringField(required=False)\n    cast = db.ListField(db.StringField(), required=True)\n\nclass MoviesApi(Resource):\n    def get(self):\n        movies = Movie.objects().to_json()\n        return Response(movies, mimetype=\"application/json\", status=200)\n\n    def post(self):\n        body = request.get_json()\n        movie = Movie(**body).save()\n        id = movie.id\n        return {'id': str(id)}, 200\n\nclass MovieApi(Resource):\n    def put(self, id):\n        body = request.get_json()\n        Movie.objects.get(id=id).update(**body)\n        return '', 200\n\n    def delete(self, id):\n        Movie.objects.get(id=id).delete()\n        return '', 200\n\n    def get(self, id):\n        movie = Movie.objects.get(id=id).to_json()\n        return Response(movie, mimetype=\"application/json\", status=200)\n\napi.add_resource(MoviesApi, '/api/movies')\napi.add_resource(MovieApi, '/api/movies/<id>')\n\n@app.route('/api/healthcheck')\ndef health_check():\n    return {'HealthCheckResponse': True}\n\napp.run(host='0.0.0.0', port=port)\n")),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"import.py")," application is executed before the API application on every instance created, however it only import the JSON db the first time it’s executed, so this avoid repeated documents or records. Similar to the simple Python application showed in this page, it uses the ",Object(n.b)("inlineCode",{parentName:"p"},"pymongo")," package to connect to the DB and insert all the documents."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-python",metastring:"path=app/import.py",path:"app/import.py"}),"from pymongo import MongoClient\nimport json\nimport os\n\nmongodb_uri = os.environ.get('APP_MONGODB_URI')\nif not mongodb_uri:\n    mongodb_uri = 'mongodb://localhost/moviedb'\n\nclient = MongoClient(mongodb_uri,\n                     ssl=True,\n                     ssl_ca_certs=\"/app/db_certificate.cert\")\n\ndbnames = client.list_database_names()\n\nif not 'moviedb' in dbnames:\n    db = client['moviedb']\n    movies = db['movie']\n    with open('./db.json') as f:\n        data = json.load(f)\n    movies.insert_many(data['movies'])\n\nclient.close()\n")),Object(n.b)("p",null,"Last but not least, the ",Object(n.b)("inlineCode",{parentName:"p"},"requirements.txt")," file with the Python packages required for this demo."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-python",metastring:"path=app/requirements.txt",path:"app/requirements.txt"}),"flask\nflask-restful\nflask-mongoengine\npymongo\n")),Object(n.b)("h2",null,"Clean up"),Object(n.b)("p",null,"Finally, when you finish using the infrastructure for any of the presented examples, cleanup everything you created with the execution of:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"terraform destroy\n")),Object(n.b)("p",null,"If the example was created with IBM Cloud Schematics, cleanup everything you created with the execution of:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"\nibmcloud schematics destroy --id $WORKSPACE_ID # Identify the Activity_ID\nibmcloud schematics logs  --id $WORKSPACE_ID --act-id Activity_ID\n\n# ... wait until it's done\n\nibmcloud schematics workspace delete --id $WORKSPACE_ID\nibmcloud schematics workspace list\n")))}m.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-iac-resources-services-index-mdx-65e6d2a1cd3426fd4fea.js.map