{"version":3,"sources":["webpack:///./src/pages/iac/getting-started-terraform/remote-state/index.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","PageDescription","AnchorLinks","AnchorLink","InlineNotification","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","small","parentName","kind","isMDXComponent"],"mappings":"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","file":"component---src-pages-iac-getting-started-terraform-remote-state-index-mdx-3e25d0307fbe4b4ac177.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/isaias/Documents/Projects/Developer_Advocate_Group/CODE_PATTERNS/ibm-asean-enterprise-cloud-patterns/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst AnchorLinks = makeShortcode(\"AnchorLinks\");\nconst AnchorLink = makeShortcode(\"AnchorLink\");\nconst InlineNotification = makeShortcode(\"InlineNotification\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <PageDescription mdxType=\"PageDescription\">\n      <p>{`Setup Terraform Remote State using etcd as backend`}</p>\n    </PageDescription>\n    <AnchorLinks small mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">Introduction to Terraform remote state</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Create a etcd database using the IBM Cloud Web Console</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Create a etcd database using the IBM Cloud CLI</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Create a etcd database using Terraform</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Backend Configuration</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Final Terraform code</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Clean up</AnchorLink>\n    </AnchorLinks>\n    <p>{`This document explains how to create and use a Terraform backend with etcd to store a Terraform remote state, as shown in the following diagram.`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"914px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"39.23611111111111%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABj0lEQVQoz41Ry07bQBT1b9BVJUDq7/AFfAGL8g18QBcomy7YIUVUIZBYLAC1EeqiLBBQqFBDIDOO7ZiHHdsT1565nsM4CUhZlSsdnfuYe2buXEtK+iWl+k5EHaVUp+I5zHK6LDuaVAfAHMqy/GH4RAhx0Gw2P1h4p5HBuMK/HGmSIIxCpHECrfWknmUZ1ev1Zat3DfRulJz1kDlAU1/PAFIyp+dYUKxAw+iJ/MCjq7NL6g0YQUMZMYyMtVqtRev3KbCxJmhrM8DW178ojUJu5KVxJFU3AInIMYrHKKrA1J7WzpGs7AN/vOpxmqRCFEVpu91emox8vFfQ+uoAlxePk6a+H+OWP+CWPaDLAjA/ghskCDIF0cvAP+0g+LiKfLMxFSzkvOD1WSEPd3N6HTtNRsR5nxzOqH9/N4mzcUpmKaQ00XD7Jz1+/kLFMCBZlmosBMIwjI3g4ruX8j8z/6gajcay5TjOEedOy7D9Cs65zRh74yrneZ7tuu4U3LFdxm13MKjitu/7B91u91utVlt4AdmyRrWRhhp9AAAAAElFTkSuQmCC')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"Terraform remote state\",\n        \"title\": \"Terraform remote state architecture\",\n        \"src\": \"/static/42b47d19b5f593a5dabf935c042d5e9c/01161/tf-remote-state.png\",\n        \"srcSet\": [\"/static/42b47d19b5f593a5dabf935c042d5e9c/7fc1e/tf-remote-state.png 288w\", \"/static/42b47d19b5f593a5dabf935c042d5e9c/a5df1/tf-remote-state.png 576w\", \"/static/42b47d19b5f593a5dabf935c042d5e9c/01161/tf-remote-state.png 914w\"],\n        \"sizes\": \"(max-width: 914px) 100vw, 914px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <p>{`The code to build these resources can be downloaded from the GitHub repository `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/\"\n      }}>{`https://github.com/IBM/cloud-enterprise-examples/`}</a>{` in the directory `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/01-getting-started/remote_state\"\n      }}>{`01-getting-started/remote_state`}</a>{`.`}</p>\n    <h2>{`Introduction to Terraform remote state`}</h2>\n    <p>{`If you are using Terraform for a personal project it’s fine to store the state in the local file `}<inlineCode parentName=\"p\">{`terraform.tfstate`}</inlineCode>{`. But in a enterprise project or if Terraform is used by a team it’s recommended and best practice to setup and use remote state. Terraform and the community give us this feature with the backends. The default backend is `}<inlineCode parentName=\"p\">{`local`}</inlineCode>{` but there are is a `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.terraform.io/docs/backends/types/index.html\"\n      }}>{`collection of backends`}</a>{` provided that you can use.`}</p>\n    <p>{`Among the benefits of using remote state we have:`}</p>\n    <ul>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Team Work`}</strong>{`: backends allow us to share the state and use it in a team to update or destroy the existing infrastructure. It’s important this backend provide the lock feature, not all of them provide it and it’s important to avoid multiple team members write at the same time on the state.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Avoid manual errors`}</strong>{`: Using a local state file and a shared storage to manually sync the changes could cause someone forget to sync the state file. A backend will always sync the state whenever it changes, automatically.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Security`}</strong>{`: A local state file save the content in plain text. It’s very common to have secrets or sensitive data in the state, so local state files are insecure.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Remote operations`}</strong>{`: Some backends or services allow to manage the operations remotely. This means you don’t need to use terraform on your system to apply the changes. You could either trigger it from a web page, API call or a CLI tool.`}</li>\n    </ul>\n    <p>{`Not everything is perfect, there are other problems that you need to solve and choose the right backend to store the state remotely. Problems such as:`}</p>\n    <ul>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Locking`}</strong>{`: When the state is shared if two team members are running Terraform at the same time, you may run into race conditions, causing conflicts, data loss and state file corruption. Make sure to select a backend or service that supports locking.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Isolation`}</strong>{`: Using the same infrastructure design in different environments may cause two or more environments use the same state file. It’s a best practice to isolate such states. Make sure the backend or service used provide a mechanism to isolate states.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Versioning`}</strong>{`: Some backends support versioning, so if there is a problem in the execution you can always go back to verify what was done and who did the change. Make sure to select a backend that support versioning, the local backend only have 2 versions but in a remote and shared state more than 2 is a must.`}</li>\n    </ul>\n    <p>{`Besides backends you can use other recommended services such as Terraform Cloud or IBM Cloud Schematics. The use of IBM Schematics offers the same benefits of backends but also support remote operations, locking, isolation, versioning and it has many options to make it secure. You can read more about it in the `}<a parentName=\"p\" {...{\n        \"href\": \"/iac/schematics\"\n      }}>{`IBM Cloud Schematics`}</a>{` pattern page.`}</p>\n    <p>{`With IBM Cloud you can use some of the existing backend such as the S3 and HTTP backed. To see an example of how to set them up read the blog post `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.ibm.com/cloud/blog/store-terraform-states-cloud-object-storage\"\n      }}>{`“Store Terraform states in Cloud Object Storage”`}</a>{`. The supporting code examples are in the GitHub repository `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/l2fprod/serverless-terraform-backend\"\n      }}>{`l2fprod/serverless-terraform-backend`}</a>{`.`}</p>\n    <p>{`This page explains how to setup a remote state using the etcd backend which requires less configuration effort compared to the S3 or HTTP backend.`}</p>\n    <p>{`The first step is to create a etcd database to store the terraform state. We can do this using the IBM Cloud Web Console, the CLI or Terraform.`}</p>\n    <h2>{`Create a etcd database using the IBM Cloud Web Console`}</h2>\n    <p>{`To create the etcd database with the IBM Cloud Web Console, follow these simple instructions:`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Go to the `}<a parentName=\"p\" {...{\n            \"href\": \"https://cloud.ibm.com\"\n          }}>{`Dashboard`}</a>{` > `}<a parentName=\"p\" {...{\n            \"href\": \"https://cloud.ibm.com/resources\"\n          }}>{`Services`}</a>{` > `}<a parentName=\"p\" {...{\n            \"href\": \"https://cloud.ibm.com/catalog\"\n          }}>{`Create Resource`}</a>{`, search for “etcd” and click on the ”`}<a parentName=\"p\" {...{\n            \"href\": \"https://cloud.ibm.com/catalog/services/databases-for-etcd\"\n          }}>{`Database for etcd`}</a>{`” tile. Or, just go directly to `}<a parentName=\"p\" {...{\n            \"href\": \"https://cloud.ibm.com/catalog/services/databases-for-etcd\"\n          }}>{`Databases for etcd`}</a></p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Select the nearest or desired region (i.e. `}<inlineCode parentName=\"p\">{`Dallas`}</inlineCode>{` which is `}<inlineCode parentName=\"p\">{`us-south`}</inlineCode>{`), it may be good to have it in the same region where the terraform code is running.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Assign a name, something related to your project (i.e. `}<inlineCode parentName=\"p\">{`terraform-remote-state-iac-demo`}</inlineCode>{`) and it’s optional but recommended to assign tags to identify and find the database later, i.e. `}<inlineCode parentName=\"p\">{`terraform:remote-state`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`app:iac-demo`}</inlineCode>{`.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Optionally, change the CPU, memory and disk allocation settings. Remember the terraform state is text and not a large one, so it may be safe to choose the smaller and cheapest memory and disk allocation. If the use of the database is not high (usually it’s not), you can select the Shared CPU.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Leave the default values for Key Protect instance and disk encryption key.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`It’s important to select ”`}<strong parentName=\"p\">{`Public network`}</strong>{`”. Mostly the execution of terraform will be outside of the IBM Cloud network so terraform will need access to the etcd database. Unless you are running terraform in a VPN same as the database or from a bastion host running on the same network, you can select Private network.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Click on “Create” button at the bottom-right corner.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Wait until the database is created, it may take some time. When it’s “Active” click on the database, then launch the Management Console, clicking on ”`}<strong parentName=\"p\">{`Launch Now`}</strong>{`” button.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Before use etcd you have to set the root password. Open the `}<strong parentName=\"p\">{`Settings`}</strong>{` tab and set the new root password in the panel `}<strong parentName=\"p\">{`Change Password`}</strong>{`.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Take note of the following information:`}</p>\n        <ol parentName=\"li\">\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`Export the environment variable `}<inlineCode parentName=\"p\">{`PASSWORD`}</inlineCode>{` with the password you set in the previous step.`}</p>\n            <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                \"className\": \"language-bash\"\n              }}>{`export PASSWORD=<here write the root password you set>\n`}</code></pre>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\"><inlineCode parentName=\"p\">{`Public GRPC endpoint`}</inlineCode>{`, you can click on the little clipboard to the right. Export the entpoint in the environment variable `}<inlineCode parentName=\"p\">{`ETCDCTL_ENDPOINTS`}</inlineCode>{` with this command:`}</p>\n            <pre parentName=\"li\"><code parentName=\"pre\" {...{\n                \"className\": \"language-bash\"\n              }}>{`export ETCDCTL_ENDPOINTS=<here goes the copied endpoint>\n`}</code></pre>\n          </li>\n          <li parentName=\"ol\">\n            <p parentName=\"li\">{`The `}<inlineCode parentName=\"p\">{`TLS certificate`}</inlineCode>{` Contents. Copy the content and save it to a file named `}<inlineCode parentName=\"p\">{`ca.crt`}</inlineCode>{` where the Terraform code is located.`}</p>\n          </li>\n        </ol>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Optionally, select the CLI tab and follow these `}<a parentName=\"p\" {...{\n            \"href\": \"https://cloud.ibm.com/docs/databases-for-etcd\"\n          }}>{`instructions`}</a>{` to setup the `}<inlineCode parentName=\"p\">{`etcdctl`}</inlineCode>{` parameters to access the database for debugging, verifications or view the terraform state.`}</p>\n      </li>\n    </ol>\n    <h2>{`Create a etcd database using the IBM Cloud CLI`}</h2>\n    <p>{`To use the IBM Cloud CLI no plugin is required, use the command `}<inlineCode parentName=\"p\">{`ibmcloud resource service-instance-create NAME databases-for-etcd PLAN LOCATION`}</inlineCode>{` to create the etcd database service (`}<inlineCode parentName=\"p\">{`databases-for-etcd`}</inlineCode>{`), with `}<inlineCode parentName=\"p\">{`standard`}</inlineCode>{` plan on Dallas (`}<inlineCode parentName=\"p\">{`us-south`}</inlineCode>{`) like so.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud resource service-instance-create demo-terraform-remote-state databases-for-etcd standard us-south\n`}</code></pre>\n    <p>{`Check the status until it’s `}<inlineCode parentName=\"p\">{`active`}</inlineCode>{` with any of the following commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud resource service-instance demo-terraform-remote-state\n# Or:\nibmcloud resource service-instances --location us-south\n# Or:\nibmcloud resource service-instances | grep demo-terraform-remote-state\n`}</code></pre>\n    <p>{`To continue with the next actions it’s required to install the Cloud Database plugin. Execute the following command if you haven’t done it yet.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud plugin install cloud-databases\n`}</code></pre>\n    <p>{`Before use etcd you have to set the root password, use the Cloud Database plugin to set it up. To choose a good password you could either use the below one-liner with `}<inlineCode parentName=\"p\">{`/dev/urandom`}</inlineCode>{` or select your own password.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`export PASSWORD=$(LC_CTYPE=C tr -dc 'a-zA-Z0-9' < /dev/urandom | head -c 32)\nibmcloud cdb user-password demo-terraform-remote-state root $PASSWORD\n`}</code></pre>\n    <InlineNotification mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Password Generator`}</strong></p>\n      <p>{`There are plenty of guidelines and tools that can help you to generate a good and secure password. If you don’t have any, you can use `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.random.org/passwords/\"\n        }}>{`https://www.random.org/passwords/`}</a>{`. It’s a simple web application to generate random passwords.`}</p>\n    </InlineNotification>\n    <p>{`Use the following commands to get the entrypoint and certificate, both required to configure the backend.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`export ETCDCTL_ENDPOINTS=$(ibmcloud cdb deployment-connections demo-terraform-remote-state --only app | grep GRPC | awk '{print $2}')\n# Or using jq:\nexport ETCDCTL_ENDPOINTS=$(ibmcloud cdb deployment-connections demo-terraform-remote-state --json | jq -r '.connection.grpc.composed[0]')\n\nibmcloud cdb deployment-cacert demo-terraform-remote-state --save --certroot cacert && mv cacert/* ca.crt && rmdir cacert\n`}</code></pre>\n    <p>{`Optionally, you can configure the environment with the following command to use `}<inlineCode parentName=\"p\">{`etcdctl`}</inlineCode>{` for debugging, validations or read the terraform state.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`export ETCDCTL_API=3\nexport ETCDCTL_CACERT=\\${PWD}/ca.crt\nexport ETCDCTL_ENDPOINTS=$(ibmcloud cdb deployment-connections demo-terraform-remote-state --only cli | grep CLI | sed 's/.*endpoints=\\\\([^ ]*\\\\) .*/\\\\1/')\nexport ETCDCTL_USER=root:$PASSWORD\n`}</code></pre>\n    <p>{`With the variables `}<inlineCode parentName=\"p\">{`ETCDCTL_API`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`ETCDCTL_CACERT`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`ETCDCTL_ENDPOINTS`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`ETCDCTL_USER`}</inlineCode>{` exported and `}<inlineCode parentName=\"p\">{`etcdctl`}</inlineCode>{` installed you can run commands like these to verify your connectivity:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ etcdctl put foo bar\nOK\n$ etcdctl get foo\nfoo\nbar\n`}</code></pre>\n    <h2>{`Create a etcd database using Terraform`}</h2>\n    <p>{`Terraform can also help you to create the etcd database. Make sure to not have this terraform code to create the backend in a different directory from any other terraform code that will use `}<strong parentName=\"p\">{`etcd`}</strong>{` as a backend. This will allow you to create the backend independently and then work with your other code to manage your infrastructure.`}</p>\n    <p>{`Create the `}<inlineCode parentName=\"p\">{`etcd`}</inlineCode>{` directory in a different location where your code is. Inside create the file `}<inlineCode parentName=\"p\">{`main.tf`}</inlineCode>{` with the following code using the resource `}<inlineCode parentName=\"p\">{`ibm_database`}</inlineCode>{` to create the etcd database. In the code we also define the variables for the resources name prefix, the region and the root password.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=main.tf\",\n        \"path\": \"main.tf\"\n      }}>{`variable \"prefix\" {}\nvariable \"etcd_admin_password\" {\n  default = \"$uPerSeCre7Pa55w0r\"\n}\n\nvariable \"region\" {\n  default = \"us-south\"\n}\n\nprovider \"ibm\" {\n  generation = 2\n  region     = var.region\n}\n\ndata \"ibm_resource_group\" \"group\" {\n  name = \"Default\"\n}\n\nresource \"ibm_database\" \"etcd_terraform_remote_state\" {\n  name                         = \"\\${var.prefix}-remote-state\"\n  plan                         = \"standard\"\n  location                     = var.region\n  service                      = \"databases-for-etcd\"\n  resource_group_id            = data.ibm_resource_group.group.id\n  adminpassword                = var.etcd_admin_password\n  members_memory_allocation_mb = 3072\n  members_disk_allocation_mb   = 61440\n\n  tags = [\"\\${var.prefix}\", \"terraform\", \"remote state\"]\n}\n`}</code></pre>\n    <InlineNotification kind=\"warning\" mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Keep your Terraform code separated`}</strong></p>\n      <p>{`In the GitHub repository the `}<inlineCode parentName=\"p\">{`etcd`}</inlineCode>{` directory with the etcd database management is stored in the directory where the code is just for educational purposes, do not do this in your project.`}</p>\n    </InlineNotification>\n    <InlineNotification kind=\"warning\" mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Root password`}</strong></p>\n      <p>{`For simplicity we set a default password for `}<inlineCode parentName=\"p\">{`root`}</inlineCode>{` but this is not recommended in a large and enterprise project. Keep your password in a secure location and assign it always (not by default) using `}<inlineCode parentName=\"p\">{`TF_VAR_`}</inlineCode>{` environment variables or the `}<inlineCode parentName=\"p\">{`terraform`}</inlineCode>{` `}<inlineCode parentName=\"p\">{`-var`}</inlineCode>{` parameters.`}</p>\n      <p>{`You can use the one-liner below using `}<inlineCode parentName=\"p\">{`/dev/urandom`}</inlineCode>{` to generate a random password, use your own secure password or use a password generation tool like `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.random.org/passwords/\"\n        }}>{`https://www.random.org/passwords/`}</a>{`.`}</p>\n    </InlineNotification>\n    <p>{`Executing `}<inlineCode parentName=\"p\">{`terraform apply`}</inlineCode>{` will create the etcd database but in order to get the required parameters to configure the backend lets use some output variables. Add the following code to the `}<inlineCode parentName=\"p\">{`main.tf`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=main.tf\",\n        \"path\": \"main.tf\"\n      }}>{`output \"etcd_endpoint\" {\n  value = ibm_database.etcd_terraform_remote_state.connectionstrings[0].composed\n}\noutput \"etcd_certbase64\" {\n  value = ibm_database.etcd_terraform_remote_state.connectionstrings[0].certbase64\n}\n`}</code></pre>\n    <p>{`Now export the variables required by the code and execute the terraform commands to create the database and get the output required to configure the backend, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`export TF_VAR_prefix=\"terraform-state-$USER\"\nexport TF_VAR_etcd_admin_password=$(LC_CTYPE=C tr -dc 'a-zA-Z0-9' < /dev/urandom | head -c 32)\n\nterraform init\nterraform plan\nterraform apply\n`}</code></pre>\n    <p>{`When the database is up and running, execute this command to save the CA certificate file and export the following variables to be used to configure the backend and `}<inlineCode parentName=\"p\">{`etcdctl`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform output etcd_certbase64 | base64 --decode > ../ca.crt    # On MacOS use: base64 -D\n\nexport ETCDCTL_ENDPOINTS=$(terraform output etcd_endpoint)\n\nexport ETCD_USER=$(terraform output etcd_password)\nexport ETCD_PASSWD=$(terraform output etcd_password)\n\n# For etcdctl\nexport ETCDCTL_API=3\nexport ETCDCTL_USER=$(terraform output etcd_user):$(terraform output etcd_password)\nexport ETCDCTL_CACERT=$PWD/../ca.crt\n`}</code></pre>\n    <p>{`With the variables `}<inlineCode parentName=\"p\">{`ETCDCTL_API`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`ETCDCTL_CACERT`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`ETCDCTL_ENDPOINTS`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`ETCDCTL_USER`}</inlineCode>{` exported and `}<inlineCode parentName=\"p\">{`etcdctl`}</inlineCode>{` installed you can run commands like these to verify your connectivity:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ etcdctl put foo bar\nOK\n$ etcdctl get foo\nfoo\nbar\n`}</code></pre>\n    <h2>{`Backend Configuration`}</h2>\n    <p>{`The backend configuration can be done with Terraform code or using the parameters `}<inlineCode parentName=\"p\">{`-backend-config=\"KEY=VALUE\"`}</inlineCode>{` with the `}<inlineCode parentName=\"p\">{`terraform init`}</inlineCode>{` command. Here we will use the terraform code to configure the backend.`}</p>\n    <p>{`Go to the directory where your infrastructure code is and create the file `}<inlineCode parentName=\"p\">{`backend.tf`}</inlineCode>{` with the following content:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=backend.tf\",\n        \"path\": \"backend.tf\"\n      }}>{`terraform {\n  backend \"etcdv3\" {\n    endpoints   = [\"< value of the variable ETCDCTL_ENDPOINTS >\"]\n    password    = \"< value of the variable ETCD_PASSWD >\"\n    username    = \"root\"\n    prefix      = \"terraform-state/\"\n    lock        = true\n    cacert_path = \"ca.crt\"\n    cert_path   = \"certificate.pem\"\n    key_path    = \"key.pem\"\n  }\n}\n`}</code></pre>\n    <p>{`Due to the terraform issue `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/hashicorp/terraform/issues/19185\"\n      }}>{`#19185`}</a>{` the etcd backend requires the `}<inlineCode parentName=\"p\">{`cert_path`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`key_path`}</inlineCode>{` with a TLS key pair files. The `}<strong parentName=\"p\">{`etcd`}</strong>{` instance does not validate the actual client certificate so you may generate a self-signed certificate with a private key (`}<inlineCode parentName=\"p\">{`certificate.pem`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`key.pem`}</inlineCode>{`) with the following `}<inlineCode parentName=\"p\">{`openssl`}</inlineCode>{` command.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem -subj \"/C=US/ST=California/L=San Diego/O=IBM/OU=Terraform Backend\"\n`}</code></pre>\n    <p>{`These key pairs may not be required in the future, when this bug is fixed in Terraform or the etcd backend.`}</p>\n    <p>{`Make sure in the same location is the `}<inlineCode parentName=\"p\">{`ca.crt`}</inlineCode>{` file and choose the correct `}<inlineCode parentName=\"p\">{`prefix`}</inlineCode>{` to avoid collision with other state files from other project or environment.`}</p>\n    <InlineNotification kind=\"warning\" mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Keep it secure`}</strong></p>\n      <p>{`Please, add the `}<inlineCode parentName=\"p\">{`ca.crt`}</inlineCode>{` filename in the `}<inlineCode parentName=\"p\">{`.gitignore`}</inlineCode>{` file as well as the `}<inlineCode parentName=\"p\">{`certificate.pem`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`key.pem`}</inlineCode>{` files, just in case. Note that the `}<inlineCode parentName=\"p\">{`ca.crt`}</inlineCode>{` file will differ with the cloud `}<strong parentName=\"p\">{`etcd`}</strong>{` instance.`}</p>\n      <p>{`The `}<inlineCode parentName=\"p\">{`backend.tf`}</inlineCode>{` file also contains the root password, so it has to be included in the `}<inlineCode parentName=\"p\">{`.gitignore`}</inlineCode>{` file too.`}</p>\n    </InlineNotification>\n    <p>{`The `}<inlineCode parentName=\"p\">{`backend`}</inlineCode>{` block does not accept variables, that’s why you have to write the `}<inlineCode parentName=\"p\">{`endpoints`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`password`}</inlineCode>{` parameter. If you want to automate this process and store the `}<inlineCode parentName=\"p\">{`backend.tf`}</inlineCode>{` file (or similar) in the repository create a template like this and execute the following `}<inlineCode parentName=\"p\">{`sed`}</inlineCode>{` command to generate the final `}<inlineCode parentName=\"p\">{`backend.tf`}</inlineCode>{` with the endpoint and root password.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=backend.tf.tmpl\",\n        \"path\": \"backend.tf.tmpl\"\n      }}>{`terraform {\n  backend \"etcdv3\" {\n    endpoints   = [\"{ ETCDCTL_ENDPOINTS }\"]\n    password    = \"{ ETCD_PASSWD }\"\n    username    = \"root\"\n    prefix      = \"terraform-state/\"\n    lock        = true\n    cacert_path = \"ca.crt\"\n    cert_path   = \"certificate.pem\"\n    key_path    = \"key.pem\"\n  }\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`sed -e \"s|{ ETCDCTL_ENDPOINTS }|$ETCDCTL_ENDPOINTS|\" \\\\\n      -e \"s|{ ETCD_PASSWD }|$ETCD_PASSWD|\" backend.tf.tmpl > backend.tf\n`}</code></pre>\n    <p>{`To enable the backend you need to execute the `}<inlineCode parentName=\"p\">{`terraform init`}</inlineCode>{` command which should tell you the remote state is successfully set. Then execute `}<inlineCode parentName=\"p\">{`plan`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`apply`}</inlineCode>{`, you should not see the `}<inlineCode parentName=\"p\">{`terraform.tfstate`}</inlineCode>{` there.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform init\n\nterraform plan && terraform apply\n`}</code></pre>\n    <p>{`The code used to create the infrastructure is the same used in the `}<a parentName=\"p\" {...{\n        \"href\": \"/iac/getting-started-terraform\"\n      }}>{`Getting Started`}</a>{` page. So, to verify everything works execute this `}<inlineCode parentName=\"p\">{`curl`}</inlineCode>{` command and you should see the “Hello World” text.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`curl $(terraform output entrypoint)\n`}</code></pre>\n    <p>{`Optionally, you can use `}<inlineCode parentName=\"p\">{`etcdctl`}</inlineCode>{` to view the state file, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`etcdctl get --prefix terraform-state\n`}</code></pre>\n    <h2>{`Final Terraform code`}</h2>\n    <p>{`The Terraform code to create the infrastrucutre is the same used in the `}<a parentName=\"p\" {...{\n        \"href\": \"/iac/getting-started-terraform\"\n      }}>{`Getting Started`}</a>{` page. The only file used here is the `}<inlineCode parentName=\"p\">{`backend.tf.tmpl`}</inlineCode>{` used to generate the `}<inlineCode parentName=\"p\">{`backend.tf`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=backend.tf.tmpl\",\n        \"path\": \"backend.tf.tmpl\"\n      }}>{`terraform {\n  backend \"etcdv3\" {\n    endpoints   = [\"{ ETCDCTL_ENDPOINTS }\"]\n    password    = \"{ ETCD_PASSWD }\"\n    username    = \"root\"\n    prefix      = \"terraform-state/\"\n    lock        = true\n    cacert_path = \"ca.crt\"\n    cert_path   = \"certificate.pem\"\n    key_path    = \"key.pem\"\n  }\n}\n`}</code></pre>\n    <p>{`In the `}<inlineCode parentName=\"p\">{`etcd`}</inlineCode>{` directory have the `}<inlineCode parentName=\"p\">{`main.tf`}</inlineCode>{` file to manage the etcd database to store the remote state. The file is like this:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=main.tf\",\n        \"path\": \"main.tf\"\n      }}>{`variable \"prefix\" {}\nvariable \"etcd_admin_password\" {\n  default = \"$uPerSeCre7Pa55w0r\"\n}\n\nvariable \"region\" {\n  default = \"us-south\"\n}\n\nprovider \"ibm\" {\n  generation = 2\n  region     = var.region\n}\n\ndata \"ibm_resource_group\" \"group\" {\n  name = \"Default\"\n}\n\nresource \"ibm_database\" \"etcd_terraform_remote_state\" {\n  name                         = \"\\${var.prefix}-remote-state\"\n  plan                         = \"standard\"\n  location                     = var.region\n  service                      = \"databases-for-etcd\"\n  resource_group_id            = data.ibm_resource_group.group.id\n  adminpassword                = var.etcd_admin_password\n  members_memory_allocation_mb = 3072\n  members_disk_allocation_mb   = 61440\n\n  tags = [\"\\${var.prefix}\", \"terraform\", \"remote state\"]\n}\n\noutput \"etcd_endpoint\" {\n  value = ibm_database.etcd_terraform_remote_state.connectionstrings[0].composed\n}\noutput \"etcd_certname\" {\n  value = ibm_database.etcd_terraform_remote_state.connectionstrings[0].certname\n}\noutput \"etcd_certbase64\" {\n  value = ibm_database.etcd_terraform_remote_state.connectionstrings[0].certbase64\n}\noutput \"etcd_user\" {\n  value = ibm_database.etcd_terraform_remote_state.adminuser\n}\noutput \"etcd_password\" {\n  value = ibm_database.etcd_terraform_remote_state.adminpassword\n}\n`}</code></pre>\n    <h2>{`Clean up`}</h2>\n    <p>{`When you finish with the demo you can terminate all the created resources using the `}<inlineCode parentName=\"p\">{`terraform destroy`}</inlineCode>{` command. However, it is extremely important to not destroy the etcd database used by the backend until the entire infrastructure is destroyed.`}</p>\n    <p>{`The backend storage is the first resource to create and the last one to destroy.`}</p>\n    <p>{`If the etcd database was created using the `}<strong parentName=\"p\">{`IBM Cloud Web Console`}</strong>{`, select the 3 dots `}<inlineCode parentName=\"p\">{`...`}</inlineCode>{` where the etcd database is in the Resource List page, then select “Delete”.`}</p>\n    <p>{`If the database was created using the IBM Cloud CLI, it can be destroyed with the following command:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud resource service-instance-delete demo-terraform-remote-state\n`}</code></pre>\n    <p>{`And finally, if the database was created with Terraform, execute the `}<inlineCode parentName=\"p\">{`destroy`}</inlineCode>{` command like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform destroy\n`}</code></pre>\n    {\n      /*\n      TODO: Mention it's possible to see the logs from LogDNA\n      */\n    }\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}